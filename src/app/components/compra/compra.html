<main class="container p-5" *ngIf="userLoggedIn; else noLogin">
  <h1 class="mb-4 fw-semibold">Compra</h1>
  <div class="shop-layout">
    <section class="product-list">
      <div class="product-item shadow-sm" *ngFor="let articulo of articulos">
        <img src="assets/img/prueba.jpg" [alt]="articulo.nombre" />
        <div class="info">
          <h4>{{ articulo.nombre }}</h4>
          <p class="small text-muted">{{ articulo.descripcion }}</p>
          <strong>${{ articulo.precio }}</strong>
        </div>
        <div class="actions">
          <input type="number" min="1" [(ngModel)]="cantidades[articulo.id]" class="form-control qty-input"
            placeholder="1" />
          <button class="btn btn-success add-btn" (click)="agregarAlCarrito(articulo)" title="Agregar al carrito">
            +
          </button>
        </div>
      </div>
    </section>
    <aside class="cart shadow-sm mt-4 mt-lg-0">
      <h3 class="fw-semibold mb-3 text-primary">Tu carrito</h3>
      <ul class="cart-list" *ngIf="carrito.length > 0; else vacio">
        <li *ngFor="let item of carrito">
          <span>{{ item.articulo.nombre }} ×{{ item.cantidad }}</span>
          <span class="remove" (click)="quitarDelCarrito(item.articulo.id)" title="Quitar del carrito">✕</span>
        </li>
      </ul>
      <ng-template #vacio>
        <p class="text-muted small">Tu carrito está vacío.</p>
      </ng-template>

      <div class="total mt-3">
        <span>Total:</span>
        <strong>${{ total }}</strong>
      </div>

      <button (click)="finalizarCompra()" class="btn finalizar-btn w-100 mt-3" [disabled]="carrito.length === 0">
        Finalizar compra
      </button>
    </aside>
  </div>
</main>
<div class="loading-overlay" *ngIf="loading">
  <div class="spinner">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
    <p class="mt-2 fw-semibold">Procesando la compra, por favor espere...</p>
  </div>
</div>
<ng-template #noLogin>
  <div class="text-center py-5 bg-white rounded-4 shadow-sm mx-3">
    <p class="fw-semibold mb-3">Debés iniciar sesión para acceder a la sección de compras.</p>
    <a routerLink="/login" class="btn btn-primary px-4 py-2 rounded-pill shadow-sm">Iniciar sesión</a>
  </div>
</ng-template>